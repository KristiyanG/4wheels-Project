
package connectors;

import java.beans.Statement;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;

import busynesLogic.models.User;



public class UserCo {

	private Connection connection;

	public UserCo() {
		try {
			Class.forName("com.mysql.jdbc.Driver").newInstance();
		} catch (InstantiationException | IllegalAccessException | ClassNotFoundException e) {
			System.out.println("Unable to find and load driver");
		}
	}

	public void connectToDB() {
		try {
			System.out.println("Constructor");
			this.connection = DriverManager.getConnection("jdbc:mysql://localhost/mobile?autoReconnect=true&useSSL=false&user=root&password=1234");
		} catch (SQLException e) {
			displaySqlErrors(e);
		}
	}

	public	void insertUser() {
//		if (user == null) {
//			return false;
//		}
		try {
//			java.sql.Statement statement = connection.createStatement();
//			ResultSet rs = statement
//					.executeQuery(String.format("select name from users where name = 'Kristiyan' "));
//			if (!rs.next()) {
//				int i = statement.executeUpdate(
//						String.format("insert into users values "+ user.getEmail()+
//								user.getPassword()));
//				rs.close();
//				statement.close();
//				connection.close();
//			
//			}
			java.sql.Statement stmt = connection.createStatement();
			ResultSet rs = stmt.executeQuery(
			 "SELECT first_name FROM users");

			rs.close();
			
			connection.close();
			

		} catch (SQLException e) {
			displaySqlErrors(e);
			
		}
	}

//	public User getUser(String email) {
//		try {
//			java.sql.Statement statement = connection.createStatement();
//			ResultSet rs = statement.executeQuery(String.format("select * from users where email = '%s'", email));
//			if (!rs.next()) {
//				return null;
//			}
//
//			User user = new User(rs.getString(2), rs.getString(3), rs.getString(4), rs.getString(1), rs.getString(5));
//			// TODO populate user's visited places
//			rs.close();
//			statement.close();
//			connection.close();
//			return user;
//		} catch (SQLException e) {
//			displaySqlErrors(e);
//			return null;
//		} catch (InvalidDataException e) {
//			e.printStackTrace();
//			return null;
//		}
//
//	}

	public boolean validateUser(String email, String password) {
		java.sql.Statement statement;
		try {
			statement = connection.createStatement();
			ResultSet rs = statement.executeQuery(String.format("select * from users where email = '%s'", email));
			if (!rs.next()) {
				return false;
			}

			String pass = rs.getString(4);
			if (pass.equals(password)) {
				return true;
			}

			return false;
		} catch (SQLException e) {
			displaySqlErrors(e);
		}
		return false;
	}

	private void displaySqlErrors(SQLException e) {
		System.out.println("===");
		System.out.println("SQLException: " + e.getMessage());
		System.out.println("SQLState: " + e.getSQLState());
		System.out.println("Vendor error: " + e.getErrorCode());
		
	}
}
